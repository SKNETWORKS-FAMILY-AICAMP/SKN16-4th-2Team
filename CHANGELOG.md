# 변경 로그

## [2024-12-19] 관리자 로그인 문제 해결

### 🚨 문제점
- PostgreSQL 데이터 지속성 문제: 볼륨 설정이 완전하지 않아 컨테이너 재시작 시 데이터 손실
- 초기 데이터 생성 로직: setup.bat에서만 실행되고 컨테이너 시작 시 자동 실행되지 않음
- 중복 생성 방지 부족: 기존 데이터 확인 없이 데이터 생성 시도로 인한 오류

### ✅ 해결책

#### 1. 데이터베이스 초기화 개선
- **파일**: `backend/app/database.py`
- **변경사항**: `drop_all()` 로직 제거하여 기존 데이터 보존
- **효과**: 컨테이너 재시작 시에도 사용자 데이터 유지

#### 2. Docker Compose 자동 초기화
- **파일**: `docker-compose.yml`
- **변경사항**: 
  - 포트를 5432로 변경
  - 서비스명을 `postgres`로 변경
  - 백엔드 컨테이너 시작 시 자동 초기 데이터 생성
  - pgAdmin 추가 (개발 환경용)
- **효과**: 컨테이너 시작 시마다 자동으로 초기 데이터 확인/생성

#### 3. 초기 데이터 생성 스크립트 개선
- **파일**: `backend/app/init_data.py`
- **변경사항**:
  - 강화된 중복 방지 로직
  - 상세한 로깅 및 에러 처리
  - 데이터 무결성 검증 추가
- **효과**: 안전하고 신뢰할 수 있는 초기 데이터 생성

#### 4. 진단 도구 추가
- **파일**: `diagnose.bat`
- **기능**:
  - Docker 컨테이너 상태 확인
  - 데이터베이스 연결 테스트
  - 사용자 데이터 확인
  - 환경 변수 검증
  - 자동화된 문제 해결 가이드

#### 5. 설정 스크립트 개선
- **파일**: `setup.bat`
- **변경사항**: 새로운 포트 설정 반영 및 개선된 사용자 경험

#### 6. 초기화 SQL 스크립트 추가
- **파일**: `init-db.sql`
- **기능**: PostgreSQL 초기 설정 및 pgvector 확장 활성화

### 🔧 사용법

#### 새로운 시작 방법
```bash
# 1. 전체 시스템 실행
docker-compose up -d

# 2. 자동으로 초기 데이터가 생성됩니다!

# 3. 브라우저에서 접속
# - 프론트엔드: http://localhost:3000
# - API 문서: http://localhost:8000/docs
# - pgAdmin: http://localhost:5050 (개발 환경)
```

#### 문제 진단
```bash
# 시스템 상태 진단
.\diagnose.bat
```

#### 테스트 계정
- **관리자**: admin@bank.com / admin123
- **멘토**: mentor@bank.com / mentor123  
- **멘티**: mentee@bank.com / mentee123

### 🎯 주요 개선사항

1. **자동 초기화 시스템**: 컨테이너 시작 시마다 초기 데이터 존재 여부 확인
2. **영구 볼륨 보장**: Docker named volume 사용으로 데이터 지속성 보장
3. **문제 진단 도구**: 언제든 시스템 상태 확인 가능
4. **사용자 친화적 인터페이스**: 명확한 가이드와 에러 메시지 제공

### ⚠️ 주의사항

- 기존 데이터베이스가 있다면 백업 후 마이그레이션 권장
- 포트가 5433에서 5432로 변경되었으므로 기존 연결 설정 확인 필요
- pgAdmin은 개발 환경에서만 실행됩니다 (profiles: dev)
